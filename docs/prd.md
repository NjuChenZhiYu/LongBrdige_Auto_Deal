# 美股期权自动化交易系统 - 需求规格说明书 (PRD)

## 1. 项目愿景
基于长桥证券 OpenAPI，实现一套集实时行情监控、深度数据分析、移动端告警及自动化交易于一体的系统。旨在通过美股数据和期权数据精准捕捉买卖盘力量，辅助正股和期权交易决策。

---

## 2. 核心模块需求

### 2.1 行情订阅 (Quote & Depth)
* **需求定义**：实时订阅美股正股及期权行情。
* **数据范围**：需涵盖全美综合行情 (US Quote) 及期权实时行情 (OPRA)。
* **性能要求**：行情推送延迟控制在 **< 300ms**。
* **可靠性**：支持断线后 5 分钟内自动重连，并记录错误日志。

### 2.2 算法分析 (Algorithm Engine)
* **价格波动监控**：当标的价格瞬时涨跌幅 **≥ 2%** 时触发信号。
* **买卖盘深度 (Level 2)**：
    * 计算买卖盘价差 (Bid/Ask Spread)，要求 **≤ 1%** 以保证流动性。
    * 识别买卖盘挂单量失衡，捕捉大单异动。
* **验证逻辑**：支持通过模拟数据流进行算法准确性校验。

### 2.3 告警推送 (Mobile Notification)
* **推送通道**：集成飞书 (Feishu) 或钉钉 (DingTalk) Webhook。
* **响应速度**：从算法触发到移动端接收，总延迟 **< 5s**。
* **内容要素**：标的代码、当前价格、触发原因、买卖盘深度快照。

### 2.4 交易执行 (Trade Execution)
* **订单类型**：支持限价单 (Limit) 与市价单 (Market)。
* **风险控制**：
    * **手动开关**：下单权限默认关闭，需通过配置文件或手机端指令手动开启。
    * **价格保护**：下单价格必须在当前一档买卖盘合理区间内，防止异常价格成交。
* **状态反馈**：订单成交、拒绝或取消需实时推送至手机。

---

## 3. 运维与部署需求
* **常驻运行**：系统需在服务器 7x24 小时运行。
* **自启动**：服务器异常重启后，系统具备进程守护（如 PM2 或 systemd）自动恢复。
* **日志规范**：日志按天切分，单文件上限 **100MB**，确保不撑爆磁盘。

---

## 4. 业务流程示意


---

## 5. 验收标准
* **行情稳定性**：日内连接中断次数 < 3 次（交易所维护期除外）。
* **信号准确率**：算法产生的信号需与长桥 App 端实时数据完全吻合。
* **部署性**：在 Trae 中可一键完成依赖安装并启动主程序。